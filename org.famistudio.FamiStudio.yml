app-id: org.famistudio.FamiStudio
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.mono6
cleanup-commands:
  - mkdir -p ${FLATPAK_DEST}/lib/ffmpeg    
command: famistudio.sh
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
# Read and write projects 
  - --filesystem=home
# For the Mono runtime
  - --env=MONO_GAC_PREFIX=${FLATPAK_DEST}
# Midi keyboard input
  - --device=all
modules:

  - name: mono6
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/mono6/install.sh

  - name: extralibs
    buildsystem: simple
    build-commands:
      - cp -ar /usr/lib/sdk/mono6/lib/mono/gac/System.Drawing /app/lib/mono/gac/ && rm -f /app/lib/mono/gac/System.Drawing/*/*.pdb
      - cp -ar /usr/lib/sdk/mono6/lib/mono/gac/System.Windows.Forms /app/lib/mono/gac/ && rm -f /app/lib/mono/gac/System.Windows.Forms/*/*.pdb

  - name: app
    buildsystem: simple
    build-commands:
      - install -d /app/bin/
      - cp -r * /app/bin/
      - ln -sf /usr/lib/x86_64-linux-gnu/libopenal.so.1 /app/bin/libopenal32.so
    sources:
      - type: archive
        url: https://github.com/BleuBleu/FamiStudio/releases/download/4.0.4/FamiStudio404-LinuxAMD64.zip
        sha256: 576590a1e3c624064d7e00a1de71d2d66be46186851f49427231dda0dfcf8244
        strip-components: 0

  - name: extrafiles
    buildsystem: simple
    build-commands:
      - install -Dm755 famistudio.sh ${FLATPAK_DEST}/bin/famistudio.sh
      - install -Dm644 org.famistudio.FamiStudio.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/org.famistudio.FamiStudio.svg
      - install -Dm644 org.famistudio.FamiStudio.desktop ${FLATPAK_DEST}/share/applications/org.famistudio.FamiStudio.desktop
      - install -Dm644 org.famistudio.FamiStudio.metainfo.xml ${FLATPAK_DEST}/share/metainfo/org.famistudio.FamiStudio.metainfo.xml
    sources:
      - type: file
        path: famistudio.sh
      - type: file
        path: org.famistudio.FamiStudio.svg
      - type: file
        path: org.famistudio.FamiStudio.desktop
      - type: file
        path: org.famistudio.FamiStudio.metainfo.xml
